<!DOCTYPE html>
<html>
<head>
  <title>ONNX Runtime Web Inference</title>
</head>
<body>
  <h1>ONNX Runtime Web Inference</h1>
  <label for="user-text">Enter text:</label>
  <input type="text" id="user-text" placeholder="Your text here" />
  <button id="classify-btn">Classify Text</button>
  <p>Predicted class id: <span id="predicted-class-id"></span></p>
  <p>Prediction: <span id="prediction"></span></p>
  <p>Inference time: <span id="inference-time"></span> ms</p>

  <!-- ONNXRuntime Web import -->
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>

  <script type="module">
    import { AutoTokenizer } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.16.0';

    async function runInference(text) {
      try {
        const session = await ort.InferenceSession.create('models/Xenova/distilbert-base-uncased-finetuned-sst-2-english/onnx/distilbert.onnx');
        const tokenizer = await AutoTokenizer.from_pretrained('Xenova/distilbert-base-uncased-finetuned-sst-2-english');

        const tokenized = tokenizer(text, {
          addSpecialTokens: true,
          padding: true,
          returnAttentionMask: true,
        });

        const inputData = {
          input_ids: new ort.Tensor('int64', tokenized.input_ids.data, [1, tokenized.input_ids.data.length]),
          attention_mask: new ort.Tensor('int64', tokenized.attention_mask.data, [1, tokenized.attention_mask.data.length])
        };

        const startTime = performance.now();
        const outputs = await session.run(inputData);
        const endTime = performance.now();
        const inferenceTime = endTime - startTime;

        const logitsData = outputs.logits.cpuData;
        const predictedClassId = logitsData.indexOf(Math.max(...logitsData));
        const prediction = predictedClassId === 0 ? 'Negative' : 'Positive';

        document.getElementById('predicted-class-id').textContent = predictedClassId;
        document.getElementById('prediction').textContent = prediction;
        document.getElementById('inference-time').textContent = inferenceTime.toFixed(2);
      } catch (error) {
        console.error('Inference error:', error);
      }
    }

    document.getElementById('classify-btn').addEventListener('click', () => {
      const userText = document.getElementById('user-text').value;
      if (!userText) {
        alert("Please enter some text.");
        return;
      }
      runInference(userText);
    });
  </script>
</body>
</html>
